\subsection{Total Variation : $R(x) = \lVert \nabla x \rVert_{1}$}

\frame{
    \tableofcontents[ 
        currentsubsection, 
        % hideothersubsections,
        % sectionstyle=show/hide,
        % subsectionstyle=show/shaded,
    ]
}

\begin{frame}{Remarques sur la notation $\nabla$ (gradient)}

% \begin{align*}
% \nabla 
% = \begin{bmatrix} \frac{d}{dx} \\ \frac{d}{dy} \end{bmatrix}
% = \begin{bmatrix} \nabla_{x} \\ \nabla_{y} \end{bmatrix}
% \end{align*}

\begin{align*}
\nabla 
&= \begin{bmatrix} \frac{d}{dx} \\ \frac{d}{dy} \end{bmatrix}
= \begin{bmatrix} \nabla_{x} \\ \nabla_{y} \end{bmatrix} \\
\nabla^{T}
&= \begin{bmatrix} \frac{d}{dx} \\ \frac{d}{dy} \end{bmatrix}^{T}
= \begin{bmatrix} \frac{d}{dx} & \frac{d}{dy} \end{bmatrix} \\
&= \begin{bmatrix} \nabla_{x} \\ \nabla_{y} \end{bmatrix}^{T}
= \begin{bmatrix} \nabla_{x}^{T} & \nabla_{y}^{T} \end{bmatrix} 
\text{(Transpose of block matrix)} \\
\nabla f 
&= \begin{bmatrix} \frac{d}{dx} \\ \frac{d}{dy} \end{bmatrix} f 
= \begin{bmatrix} \frac{df}{dx} \\ \frac{df}{dy} \end{bmatrix}
= \begin{bmatrix} \nabla_{x}f \\ \nabla_{y}f \end{bmatrix}
\end{align*}


\end{frame}

\begin{frame}{Remarques sur la notation $\Delta$ (Laplacien)}

\begin{align*}
\nabla^{T} \nabla &= \begin{bmatrix} 
\frac{d}{dx} \\ 
\frac{d}{dy} 
\end{bmatrix}^{T}
\begin{bmatrix} 
\frac{d}{dx} \\ 
\frac{d}{dy} 
\end{bmatrix}
= \begin{bmatrix} 
\frac{d}{dx} & \frac{d}{dy} 
\end{bmatrix} \begin{bmatrix} 
\frac{d}{dx} \\ 
\frac{d}{dy} 
\end{bmatrix}
= \frac{d^{2}}{dx^{2}} + \frac{d^{2}}{dy^{2}}
= \Delta \\
&= \begin{bmatrix} 
\nabla_{x} \\ 
\nabla_{y} 
\end{bmatrix}^{T}
\begin{bmatrix} 
\nabla_{x} \\ 
\nabla_{y} 
\end{bmatrix}
= \begin{bmatrix} 
\nabla_{x}^{T} & \nabla_{y}^{T}
\end{bmatrix} \begin{bmatrix} 
\nabla_{x} \\ 
\nabla_{y} 
\end{bmatrix}
= \nabla_{x}^{T} \nabla_{x} + \nabla_{y}^{T} \nabla_{y}
= \Delta \\
\end{align*}

\end{frame}

\begin{frame}{$R(x) = \lVert \nabla x \rVert_{1}$}

Résolution avec l'ADMM:
\begin{itemize}
    \item Équation : $\min\limits_{x, z} \{ 
        \frac{1}{2} \lVert y - Hx \rVert_{2}^{2} 
        + \lambda \lVert z \rVert_{1} 
    \}$
    \item Contrainte : $\nabla x = (d_{x}, d_{y}) = z 
    \iff (d_x = z_x)$ and $(d_y = z_y)$
\end{itemize}
    
Lagrangien augmenté :

\resizebox{1\linewidth}{!}{
\begin{minipage}{\linewidth}
\begin{align*}
L(x, z, u) 
&= \frac{1}{2} \lVert y - Hx \rVert_{2}^{2} 
+ \lambda \lVert z \rVert_{1} +
u^{T}(\nabla x - z) 
+ \frac{\rho}{2} \lVert \nabla x - z \rVert_{2}^{2} \\
&= \frac{1}{2} \lVert y - Hx \rVert_{2}^{2} 
+ \lambda \lVert z \rVert_{1} +
\frac{\rho}{2} \lVert \nabla x - z + \frac{u}{\rho} \rVert_{2}^{2} 
- \frac{\lVert u \rVert_{2}^{2}}{2\rho} \\
&= \frac{1}{2} \lVert y - Hx \rVert_{2}^{2} 
+ \lambda \lVert (d_x, d_y) \rVert_{1} +
\frac{\rho}{2} \lVert d_x - z_x + \frac{u_x}{\rho} \rVert_{2}^{2} 
- \frac{\lVert u_x \rVert_{2}^{2}}{2\rho}
+ \frac{\rho}{2} \lVert d_y - z_y + \frac{u_y}{\rho} \rVert_{2}^{2} 
- \frac{\lVert u_y \rVert_{2}^{2}}{2\rho}
\end{align*}
\end{minipage}
}

\end{frame}

\begin{frame}{$\arg\min\limits_{x} {L(x, z, u)}$}
\begin{align*}
&\frac{d}{dx} \{
    \frac{1}{2} \lVert y - Hx \rVert_{2}^{2} 
    + \lambda \lVert z \rVert_{1} +
    \frac{\rho}{2} \lVert \nabla x - z + \frac{u}{\rho} \rVert_{2}^{2} 
    - \frac{\lVert u \rVert_{2}^{2}}{2\rho} 
\} = 0 \\
&\iff -H^{T} (y - Hx) + \rho \nabla^{T} (\nabla x - z + \frac{u}{\rho}) = 0 \\
&\iff -H^{T} (y - Hx) 
+ \rho \nabla^{T} \nabla x 
- \rho \nabla^{T} z 
+ \rho \nabla^{T} u = 0 \\
&\iff -H^{T} y +  H^{T}H x 
+ \rho \nabla^{T} \nabla x 
- \rho \nabla^{T} z 
+ \rho \nabla^{T} u = 0 \\
&\iff -H^{T} y 
+  (H^{T}H + \rho \nabla^{T} \nabla) x 
- \rho \nabla^{T} z 
+ \rho \nabla^{T} u = 0 \\
&\iff
(H^{T}H + \rho \nabla^{T} \nabla) x 
= H^{T} y  + \rho \nabla^{T} z - \rho \nabla^{T} u\\
&\iff x = (H^{T}H + \rho \nabla^{T} \nabla)^{-1} 
(H^{T} y  + \rho \nabla^{T} z - \rho \nabla^{T} u)\\
\end{align*}
\end{frame}

\begin{frame}{$\arg\min\limits_{z} {L(x, z, u)}$}
\begin{align*}
&\frac{d}{dz} \{
    \frac{1}{2} \lVert y - Hx \rVert_{2}^{2} 
    + \lambda \lVert z \rVert_{1} 
    + \frac{\rho}{2} \lVert x - z + \frac{u}{\rho} \rVert_{2}^{2} 
    - \frac{\lVert u \rVert_{2}^{2}}{2\rho}
\} = 0 \\
&\iff \lambda sign(z) + \rho (x - z + \frac{u}{\rho})  = 0 \\
&\iff \lambda sign(z) + \rho x - \rho z + u  = 0 \\
&\iff -\lambda sign(z) + \rho z  = \rho x + u \\
&\iff  z - \frac{\lambda}{\rho} sign(z) = x + \frac{u}{\rho} \\
&\iff  z = sign(x + \frac{u}{\rho}) 
\times max(|x + \frac{u}{\rho}| 
- \frac{\lambda}{\rho}, 0) \\
&\iff  z = Soft_{\frac{\lambda}{\rho}}(x + \frac{u}{\rho})
\end{align*}
\end{frame}

\begin{frame}{Algorithm}
\begin{algorithm}[H]
    \caption{ADMM} % \label{euclid}
    \begin{algorithmic}[1]
        \Procedure{ADMM}{}\newline
        \textbf{Input:} $y$, $\lambda$, $\rho$, $nb\_iterations$ \\
        \textbf{Output:} $x_{nb\_iterations}$
        \For{\texttt{$k \in 0...nb\_iterations$}}
            \State{$x_{k+1} = (H^{T}H + \rho I)^{-1} (H^{T} y_{k} + \rho z_{k} - u_{k})$}
            \State{$z_{k+1} = Soft_{\frac{\lambda}{\rho}}(x_{k+1} + \frac{u_{k}}{\rho})$}
            \State{$u_{k+1} = u_{k} + \rho (z_{k+1} - x_{k+1})$}
        \EndFor
        \EndProcedure
    \end{algorithmic}
    % \label{alg_1}
\end{algorithm}
\end{frame}